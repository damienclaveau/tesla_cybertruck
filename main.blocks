<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="W-.Xi6w$-bkAn9_5`K*T">compass_heading2</variable><variable id="0__YIz#bQzDzkJ%;kn}m">cycles_count</variable><variable id="l]vBo2z0p/zVhiQ#p-dG">compass_heading</variable><variable id="7M@27CTp99ghD8^U`xSH">avg_loop_rate</variable><variable id="ty`/`)11jPG0B*Q0m+|4">runtime_ms</variable></variables><block type="pxt-on-start" id="^:SzUy{]t+~-#|ksS?p5" x="20" y="20"><statement name="HANDLER"><block type="variables_set" id="fR!4Fv_J$VZm91kmlMJX"><field name="VAR" id="l]vBo2z0p/zVhiQ#p-dG">compass_heading</field><value name="VALUE"><shadow type="math_number" id="1(8Z9izbq.}p@}HhO~T("><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="S]f[vSL`DLFEsqyrM6k@"><field name="VAR" id="7M@27CTp99ghD8^U`xSH">avg_loop_rate</field><value name="VALUE"><shadow type="math_number" id="X}U!Zc(Zwp[*U[`GfFG%"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="%1u^=.rUTjwO2mpXVqZj"><field name="VAR" id="ty`/`)11jPG0B*Q0m+|4">runtime_ms</field><value name="VALUE"><shadow type="math_number" id="y(l[A]+xIHw._:zK;)*l"><field name="NUM">0</field></shadow></value><next><block type="typescript_statement" id="]se.HAf]iVH?AShLDbW?"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="function check_frequency(freq: any) {" line1="    " line2="}" numlines="3"></mutation><next><block type="function_call" id="dBO1~/:]el6/RM!r.z^a"><mutation name="init" functionid=".9SA.BfHv~B#:g1AKc]{"></mutation></block></next></block></next></block></next></block></next></block></statement></block><block type="device_forever" id="agP{HCk]~2,giR`N/9n1" x="422" y="20"><statement name="HANDLER"><block type="variables_change" id="4`{:iW(n%IgTQv%2|W/a"><field name="VAR" id="0__YIz#bQzDzkJ%;kn}m">cycles_count</field><comment pinned="false" h="80" w="160">Infinite loop (frequency = 50 Hz)</comment><value name="VALUE"><shadow type="math_number" id="[n1%_7/PH~KX.XL2IhkG"><field name="NUM">1</field></shadow></value><next><block type="function_call" id="{QB1$SmF=WTE:R{/jEzV"><mutation name="loop_update_sensors" functionid="L8W74T@HY#:0fSa:#zX`"></mutation><next><block type="function_call" id="355bBoHeV,irt|Gx{5s8"><mutation name="loop_update_vision" functionid="]5),9kv2tU}Fd24f#ExY"></mutation><next><block type="function_call" id="gn1G|zz[P_B~4fGoH8o2"><mutation name="loop_state_machine" functionid="t-@?:sP,u5CKq~ng65as"></mutation><next><block type="function_call" id="/0NQUe)P#hRDb{uhDy(@"><mutation name="loop_compute_waypoint" functionid="8Ki0MV%o:zVm:V9jZU4K"></mutation><next><block type="function_call" id="K[;vfMgr]{JsO(rq6m{w"><mutation name="loop_motor_controller_run" functionid="AQ0~hj=ESNB$$45MMfVH"></mutation><next><block type="function_call" id="Q]^]!q67OW+1C1XBEq$3"><mutation name="loop_update_signals" functionid="tE.*Mq1t#lm[J#$QddAC"></mutation><next><block type="function_call" id="fDZ07:3:~BX|dUfvMuXC"><mutation name="loop_telemetry" functionid=")1aXC0(tja3l=a4Eo4[%"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="function_definition" id=";0o:Xfcw#XqdL(^-+~i+" x="800" y="20"><mutation name="loop_compute_waypoint" functionid="8Ki0MV%o:zVm:V9jZU4K"></mutation><field name="function_name">loop_compute_waypoint</field><comment pinned="false" h="80" w="160">Based on the Robot State, Goal and Environment
Determine the next waypoint to reach, and linear and angular velocities to reach it</comment></block><block type="function_definition" id="D;F9_zpVh-l.?hi]}~Ww" x="1198" y="20"><mutation name="loop_state_machine" functionid="t-@?:sP,u5CKq~ng65as"></mutation><field name="function_name">loop_state_machine</field><statement name="STACK"><block type="huskylens_initMode" id="QK=~5+XZ/AK=]wepXpan"><field name="mode">protocolAlgorithm.ALGORITHM_TAG_RECOGNITION</field><comment pinned="false" h="80" w="160">Based on input signals, current position, object recgnition and game instructions
determine the next action and next state</comment></block></statement></block><block type="function_definition" id="Xb+@]~OYz)lgM@|,FoaW" x="20" y="529"><mutation name="loop_telemetry" functionid=")1aXC0(tja3l=a4Eo4[%"></mutation><field name="function_name">loop_telemetry</field><comment pinned="false" h="80" w="160">Log metrics and update Display

huskylens.write_osd("angle diff "+str(steering_angle), 150, 30)
huskylens.write_osd("servo_angle "+str(servo_angle), 150, 60)
huskylens.write_osd("input "+str(steering_value), 150, 90)
huskylens.write_osd("head "+str(current_heading), 150, 120)
datalogger.log(
datalogger.create_cv("target_pos_dist", target_pos_dist)
,datalogger.create_cv("target_pos_theta", target_pos_theta)
,datalogger.create_cv("velocity_speed", velocity_speed)
,datalogger.create_cv("velocity_angle ", velocity_angle )
,datalogger.create_cv("compass_heading", compass_heading)
)</comment></block><block type="function_definition" id="0wpjM2r~oOxp.?NguwfX" x="356" y="529"><mutation name="init" functionid=".9SA.BfHv~B#:g1AKc]{"></mutation><field name="function_name">init</field><statement name="STACK"><block type="device_clear_display" id="Eg0l60[,Z`;1$3(p(6k-"><comment pinned="false" h="80" w="160">Boot sequence
Initialization of the sensors, variables, display, callbacks</comment><next><block type="huskylens_initI2c" id="YR!jTtwL6HiVMoFIlLp_"><next><block type="input_compass_calibrate" id="U4tx60]3Ae1grk=?xKQx"><next><block type="device_set_accelerometer_range" id="3MC|mKGq6/4){Uwp#R}q"><field name="range">AcceleratorRange.OneG</field></block></next></block></next></block></next></block></statement></block><block type="function_definition" id="5tmo{d46t94WUk#chaBj" x="767" y="529"><mutation name="loop_motor_controller_run" functionid="AQ0~hj=ESNB$$45MMfVH"></mutation><field name="function_name">loop_motor_controller_run</field><comment pinned="false" h="80" w="160">datalogger.set_column_titles("angle_diff", "servo_angle", "input", "head", "target")</comment><statement name="STACK"><block type="servoservorun" id="bf#}*ev,De}C)%5dLtxP"><field name="servo">servos.P1</field><comment pinned="false" h="80" w="160">Drive servo and motor with PWM according to updated linear and angular velocities
Set the steering servo position
amaker_motor.servo_position(amaker_motor.Servos.S1, steering_value)
servos.P0.set_angle(steering_value)
Set the servo throttle power
amaker_motor.servo_speed(amaker_motor.Servos.S3, 50)</comment><value name="speed"><shadow type="speedPicker" id="Mg.4Q^@7}Hm/L_!qI+Pv"><field name="speed">50</field></shadow></value></block></statement></block><block type="function_definition" id="{L8*p1@zq@w#f+}s2Y2w" x="1199" y="529"><mutation name="loop_update_vision" functionid="]5),9kv2tU}Fd24f#ExY"></mutation><field name="function_name">loop_update_vision</field><comment pinned="false" h="80" w="160">Capture a new video frame and analyze it : is there 1 ball, no ball, a Tag, an obstacle or nothing ?</comment></block><block type="function_definition" id="vt8c=yl~L?GwMh=$x4wb" x="20" y="863"><mutation name="loop_update_sensors" functionid="L8W74T@HY#:0fSa:#zX`"></mutation><field name="function_name">loop_update_sensors</field><statement name="STACK"><block type="variables_set" id="yNc]nHUw{=j1HSg}E.4/"><field name="VAR" id="W-.Xi6w$-bkAn9_5`K*T">compass_heading2</field><comment pinned="false" h="80" w="160">Update Compass direction, current speed, deviation, commands coming from Bluetooth, ...
Compute current position</comment><value name="VALUE"><shadow type="math_number" id="yW$`]^:_!/tWMM-x:`d7"><field name="NUM">0</field></shadow><block type="device_heading" id="`##%8RV6eL{p+!z~^o|6"></block></value></block></statement></block><block type="function_definition" id="GLlVz+!}FloL2nswP,S7" x="558" y="863"><mutation name="loop_update_signals" functionid="tE.*Mq1t#lm[J#$QddAC"></mutation><field name="function_name">loop_update_signals</field><statement name="STACK"><block type="basic_show_arrow" id="^ULxCfT8hxa*ZFn?T1Tr"><value name="i"><shadow type="device_arrow" id="`*]@3q?@5nKp|d$}R#u8"><field name="arrow">ArrowNames.North</field></shadow></value></block></statement></block></xml>